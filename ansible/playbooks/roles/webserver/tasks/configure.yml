- name: add vhost dir
  file:
    path: /var/www/{{domain}}/public_html
    owner: root
    group: root
    state: directory

- name: define dir with rights
  file:
    path: /var/www
    mode: 0755
    state: directory

- name: create home page
  template:
    src: index.html
    dest: /var/www/{{domain}}/public_html/index.html

- name: create virtual host file
  template:
    src: vhost.conf
    dest: /etc/apache2/sites-available/{{ domain }}.conf

- name: a2ensite {{ domain }}
  command: a2ensite {{ domain }}
  args:
    creates: /etc/apache2/sites-enabled/{{ domain }}.conf
  notify:
    - restart apache2